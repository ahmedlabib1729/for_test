<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Define the Delivery Note report -->
    <record id="action_report_delivery_note" model="ir.actions.report">
        <field name="name">Delivery Note (Custom)</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">custom_invoice_report.report_delivery_note_document</field>
        <field name="report_file">custom_invoice_report.report_delivery_note_document</field>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="base.paperformat_euro"/>
    </record>

    <!-- Sequence for Delivery Note Numbers -->
    <record id="seq_delivery_note" model="ir.sequence">
        <field name="name">Delivery Note</field>
        <field name="code">stock.delivery.note</field>
        <field name="prefix">DN</field>
        <field name="padding">5</field>
        <field name="company_id" eval="False"/>
    </record>

    <!-- Main report template -->
    <template id="report_delivery_note_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="custom_invoice_report.report_delivery_note_layout">
                    <t t-set="o" t-value="o"/>
                </t>
            </t>
        </t>
    </template>

    <!-- Delivery Note Layout -->
    <template id="report_delivery_note_layout">
        <div class="article o_report_layout_standard" t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id">
            <t t-set="company" t-value="o.company_id"/>

            <style>
                @page {
                    margin: 0mm;
                    size: A4;
                }

                body {
                    font-family: 'Courier New', monospace;
                    font-size: 10pt;
                    line-height: 1.3;
                    margin: 0;
                    padding: 15mm 10mm;
                }

                .delivery-container {
                    width: 100%;
                    max-width: 190mm;
                    margin: 0 auto;
                }

                .header-section {
                    display: table;
                    width: 100%;
                    margin-bottom: 5mm;
                }

                .header-left {
                    float: left;
                    width: 40%;
                }

                .header-right {
                    float: right;
                    width: 40%;
                    text-align: right;
                }

                .title-section {
                    clear: both;
                    text-align: center;
                    font-size: 14pt;
                    font-weight: bold;
                    margin: 5mm 0;
                }

                .party-info {
                    margin-bottom: 3mm;
                    border: 1px solid black;
                    padding: 2mm;
                }

                .party-info div {
                    margin-bottom: 1mm;
                }

                .payment-terms-box {
                    border: 1px solid black;
                    padding: 3mm;
                    margin-bottom: 3mm;
                }

                .items-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-bottom: 3mm;
                    font-size: 10pt;
                }

                .items-table th,
                .items-table td {
                    border: 1px solid black;
                    padding: 2mm;
                    text-align: left;
                }

                .items-table th {
                    background-color: #ffffff;
                    font-weight: bold;
                    text-align: center;
                }

                .items-table td.number {
                    text-align: right;
                }

                .items-table td.center {
                    text-align: center;
                }

                .items-table .product-code {
                    font-style: italic;
                    font-size: 9pt;
                    margin-top: 1mm;
                }

                .remarks-section {
                    margin: 5mm 0;
                }

                .footer-section {
                    margin-top: 10mm;
                    display: table;
                    width: 100%;
                }

                .footer-left {
                    float: left;
                    width: 45%;
                }

                .footer-right {
                    float: right;
                    width: 45%;
                    text-align: right;
                }

                .signature-section {
                    clear: both;
                    margin-top: 20mm;
                    display: table;
                    width: 100%;
                }

                .signature-column {
                    display: table-cell;
                    width: 33.33%;
                    text-align: center;
                    vertical-align: bottom;
                    padding: 0 5mm;
                }

                .footer-text {
                    clear: both;
                    text-align: center;
                    margin-top: 5mm;
                    text-decoration: underline;
                }

                .bold {
                    font-weight: bold;
                }

                .underline {
                    text-decoration: underline;
                }
            </style>

            <div class="delivery-container">
                <!-- Header Section -->
                <div class="header-section">
                    <div class="header-left">
                        <div><span class="bold">Delivery Note No : <t t-esc="o.name"/></span></div>
                        <div><span class="bold">Ref No : <t t-esc="o.ref_number or o.origin or ''"/></span></div>
                    </div>
                    <div class="header-right">
                        <div><span class="bold">Dated : <t t-esc="o.scheduled_date.strftime('%d-%b-%Y') if o.scheduled_date else o.date_done.strftime('%d-%b-%Y') if o.date_done else ''"/></span></div>
                    </div>
                </div>

                <!-- Title -->
                <div class="title-section">
                    DELIVERY NOTE
                </div>

                <!-- Party Information -->
                <div class="party-info">
                    <table style="width: 100%; border: none;">
                        <tr>
                            <td style="border: none; width: 15%; vertical-align: top; padding: 0;"><span class="bold">Party</span></td>
                            <td style="border: none; padding: 0;">
                                <div><span class="bold"><t t-esc="o.partner_id.name"/></span></div>
                                <div><t t-esc="o.partner_id.street or ''"/></div>
                                <div><t t-esc="o.partner_id.street2 or ''"/></div>
                            </td>
                        </tr>
                        <tr>
                            <td style="border: none; padding: 0; padding-top: 2mm;"><span class="bold">VAT</span></td>
                            <td style="border: none; padding: 0; padding-top: 2mm;"><t t-esc="o.partner_id.vat or ''"/></td>
                        </tr>
                        <tr>
                            <td style="border: none; padding: 0; padding-top: 1mm;"><span class="bold">Country</span></td>
                            <td style="border: none; padding: 0; padding-top: 1mm;"><t t-esc="o.partner_id.country_id.name or ''"/></td>
                        </tr>
                    </table>
                </div>

                <!-- Payment Terms -->
                <div class="payment-terms-box">
                    <div><span class="bold">Payment Terms</span></div>
                    <div><t t-esc="o.get_payment_terms() or 'Immediate Payment'"/></div>
                </div>

                <!-- Items Table -->
                <table class="items-table">
                    <thead>
                        <tr>
                            <th style="width: 8%;">Sl.No</th>
                            <th style="width: 52%;">Description of Goods</th>
                            <th style="width: 15%;">Quantity</th>
                            <th style="width: 10%;">Rate</th>
                            <th style="width: 7%;">Disc %</th>
                            <th style="width: 18%;">Amount Excl.VAT</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-set="line_number" t-value="0"/>
                        <t t-foreach="o.move_ids_without_package" t-as="line">
                            <t t-if="line.product_id and line.quantity > 0">
                                <t t-set="line_number" t-value="line_number + 1"/>
                                <tr>
                                    <td class="center"><span class="bold"><t t-esc="line_number"/></span></td>
                                    <td>
                                        <div><span class="bold"><t t-esc="line.product_id.name"/></span></div>
                                        <div class="product-code"><t t-esc="line.description_picking or line.product_id.default_code or ''"/></div>
                                    </td>
                                    <td class="center"><span class="bold"><t t-esc="'{:.0f}'.format(line.quantity)"/> SETS</span></td>
                                    <td class="number"></td>
                                    <td class="number"></td>
                                    <td class="number"></td>
                                </tr>
                            </t>
                        </t>
                        <!-- Total Row -->
                        <tr>
                            <td colspan="2" class="center"><span class="bold">Total</span></td>
                            <td class="center"><span class="bold"><t t-esc="'{:.0f}'.format(sum(o.move_ids_without_package.filtered(lambda m: m.quantity > 0).mapped('quantity')))"/> SETS</span></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>

                <!-- Remarks Section -->
                <div class="remarks-section">
                    <div><span class="bold">Remarks</span><span style="margin-left: 50mm;">:</span></div>
                </div>

                <!-- Footer Section -->
                <div class="footer-section">
                    <div class="footer-left">
                        Recd in Good Condition
                    </div>
                    <div class="footer-right">
                        <span class="bold">for <t t-esc="o.company_id.name"/></span>
                    </div>
                </div>

                <!-- Signature Section -->
                <div class="signature-section">
                    <div class="signature-column">
                        <div class="bold">Prepared by</div>
                    </div>
                    <div class="signature-column">
                        <div class="bold">Verified by</div>
                    </div>
                    <div class="signature-column">
                        <div class="bold">Authorised Signatory</div>
                    </div>
                </div>

                <!-- Footer Text -->
                <div class="footer-text">
                    <span class="bold">This is a Computer Generated Document</span>
                </div>
            </div>
        </div>
    </template>

</odoo>
