# Invoice Expense Tracking Module

## نظرة عامة
موديول لتتبع المصاريف المرتبطة بالفواتير وحساب الربحية الفعلية - خصيصاً للفواتير المباعة عبر منصات مثل أمازون ونون.

## المميزات الرئيسية

### 1. تسجيل المصاريف المرتبطة بالفواتير
- ربط المصاريف بفاتورة محددة
- تسجيل نوع المصروف (عمولة، شحن، تخزين، إرجاعات، غرامات)
- تحديد المنصة (أمازون، نون، أخرى)
- إنشاء قيد محاسبي تلقائي عند الترحيل

### 2. القيود المحاسبية التلقائية
- اختيار الحساب المدين والدائن
- إنشاء قيد محاسبي تلقائياً عند ترحيل المصروف
- ربط القيد بالفاتورة الأصلية

### 3. حساب الربحية التلقائي
- حساب تكلفة البضاعة المباعة
- إجمالي المصاريف المرتبطة (من الحسابات نوع expense فقط)
- صافي الربح = المبيعات - التكلفة - المصاريف
- هامش الربح %

### 4. التقارير والتحليلات
- تقرير ربحية الفاتورة (PDF)
- تحليل محوري (Pivot) للربحية
- تحليل رسومي (Graph) للاتجاهات
- تقارير مقارنة بين أمازون ونون

## كيفية الاستخدام

### إضافة مصروف لفاتورة:

#### الطريقة الأولى - من الفاتورة:
1. افتح الفاتورة
2. اذهب لتاب "Related Expenses"
3. اضغط على "Add Expense"
4. املأ البيانات:
   - الوصف
   - المبلغ
   - نوع المصروف
   - المنصة (اختياري)
   - الحساب المدين (حساب المصروف)
   - الحساب الدائن (عادة البنك)
   - الدفترية
5. احفظ واضغط "Post" لترحيل المصروف

#### الطريقة الثانية - من قائمة المصاريف:
1. اذهب إلى: Accounting > Invoice Expenses > Expenses
2. اضغط "Create"
3. اختر الفاتورة
4. املأ باقي البيانات
5. احفظ واضغط "Post"

### عرض تحليل الربحية:

#### من الفاتورة:
- افتح الفاتورة وشاهد تاب "Related Expenses"
- ستجد ملخص الربحية في نهاية التاب

#### تقرير PDF:
- افتح الفاتورة
- اضغط على Print > Invoice Profitability Report

#### تحليل متقدم:
1. اذهب إلى: Accounting > Invoice Expenses > Profitability Analysis
2. اختر الفترة والعملاء
3. اضغط "View Analysis" للتحليل المحوري
4. أو "Print Report" للتقرير المطبوع

## ملاحظات مهمة

### المصاريف التي تُحسب في الربحية:
- فقط المصاريف المرحَّلة (Posted)
- فقط إذا كان الحساب المدين من نوع "Expense"
- هذا يعطيك مرونة في إنشاء قيود أخرى لا تؤثر في حساب الربح

### القيود المحاسبية:
- يتم إنشاء قيد محاسبي تلقائياً عند الترحيل
- القيد يكون:
  - مدين: حساب المصروف
  - دائن: الحساب الذي تختاره (بنك، مورد، إلخ)
- القيد مرتبط بالفاتورة الأصلية في حقل origin

### الأمان:
- لا يمكن حذف مصروف مرحَّل
- لا يمكن إلغاء مصروف إلا إذا تم إلغاء/حذف القيد المحاسبي أولاً

## البنية التقنية

### الموديلات:
- `invoice.expense` - المصاريف المرتبطة بالفواتير
- `account.move` - وراثة لإضافة حقول الربحية

### الحقول المحسوبة:
- `total_expenses` - إجمالي المصاريف المرحَّلة
- `invoice_cost` - تكلفة البضاعة
- `net_profit` - صافي الربح
- `profit_margin` - هامش الربح %

### التقارير:
- تقرير PDF للفاتورة الواحدة
- تحليل محوري لعدة فواتير
- تحليل رسومي للاتجاهات

## التثبيت
1. انسخ المجلد إلى addons
2. حدّث قائمة التطبيقات
3. ثبّت الموديول "Invoice Expense Tracking"

## المتطلبات
- Odoo 18
- موديول account (الحسابات)
- موديول sale (المبيعات) - اختياري

## الدعم
تم تطويره بواسطة: ERP Accounting and Auditing L.L.C
الموقع: https://www.erpaccounting.ae

## الترخيص
LGPL-3
