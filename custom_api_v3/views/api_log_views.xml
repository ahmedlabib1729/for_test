<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- API Log List View -->
    <record id="view_api_log_list" model="ir.ui.view">
        <field name="name">api.log.list</field>
        <field name="model">api.log</field>
        <field name="arch" type="xml">
            <list string="API Logs" decoration-danger="status_type == 'error'" decoration-success="status_type == 'success'">
                <field name="request_date"/>
                <field name="endpoint"/>
                <field name="method"/>
                <field name="status_code"/>
                <field name="status_type" widget="badge" 
                       decoration-success="status_type == 'success'"
                       decoration-danger="status_type == 'error'"/>
                <field name="ip_address"/>
                <field name="error_message" optional="hide"/>
            </list>
        </field>
    </record>
    
    <!-- API Log Form View -->
    <record id="view_api_log_form" model="ir.ui.view">
        <field name="name">api.log.form</field>
        <field name="model">api.log</field>
        <field name="arch" type="xml">
            <form string="API Log">
                <sheet>
                    <group>
                        <group>
                            <field name="endpoint"/>
                            <field name="method"/>
                            <field name="status_code"/>
                            <field name="status_type" widget="badge"/>
                        </group>
                        <group>
                            <field name="request_date"/>
                            <field name="ip_address"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Request Data">
                            <field name="request_data" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Response Data">
                            <field name="response_data" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Error" invisible="not error_message">
                            <field name="error_message"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- API Log Search View -->
    <record id="view_api_log_search" model="ir.ui.view">
        <field name="name">api.log.search</field>
        <field name="model">api.log</field>
        <field name="arch" type="xml">
            <search string="Search API Logs">
                <field name="endpoint"/>
                <field name="ip_address"/>
                <field name="error_message"/>
                <filter name="filter_success" string="Success" domain="[('status_type', '=', 'success')]"/>
                <filter name="filter_error" string="Errors" domain="[('status_type', '=', 'error')]"/>
                <separator/>
                <filter name="filter_today" string="Today" domain="[('request_date', '>=', (context_today()).strftime('%Y-%m-%d'))]"/>
                <filter name="filter_week" string="This Week" domain="[('request_date', '>=', (context_today() - relativedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                <group expand="0" string="Group By">
                    <filter name="group_endpoint" string="Endpoint" context="{'group_by': 'endpoint'}"/>
                    <filter name="group_method" string="Method" context="{'group_by': 'method'}"/>
                    <filter name="group_status" string="Status" context="{'group_by': 'status_type'}"/>
                    <filter name="group_date" string="Date" context="{'group_by': 'request_date:day'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- API Log Action -->
    <record id="action_api_log" model="ir.actions.act_window">
        <field name="name">API Logs</field>
        <field name="res_model">api.log</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_api_log_search"/>
        <field name="context">{'search_default_filter_today': 1}</field>
    </record>
    
    <!-- Menu Items -->
    <menuitem id="menu_api_root"
              name="API Integration"
              web_icon="custom_api,static/description/icon.png"
              sequence="100"/>
    
    <menuitem id="menu_api_logs"
              name="API Logs"
              parent="menu_api_root"
              action="action_api_log"
              sequence="20"/>
</odoo>
